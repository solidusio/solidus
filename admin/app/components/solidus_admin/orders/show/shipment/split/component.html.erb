<div class="<%= stimulus_id %>" data-controller="<%= stimulus_id %>">
  <%= render component("orders/show").new(order: @order) %>
  <%= render component("ui/modal").new(title: t(".title", number: @shipment.number), close_path: close_path) do |modal| %>
    <table class="table-auto w-full">
      <thead>
        <tr>
          <th class="py-2 px-4 h-10 bg-gray-15 w-16">
            <%=
              render component("ui/forms/checkbox").new(
                form: form_id,
                "data-action": "#{stimulus_id}#selectAllRows",
                "data-#{stimulus_id}-target": "headerCheckbox",
                "aria-label": t('.select_all'),
              )
            %>
          </th>
          <th class="text-left body-small-bold text-gray-800 bg-gray-15 px-6 py-3 leading-none">
            <%= t(".product") %>
          </th>
          <th class="text-left body-small-bold text-gray-800 bg-gray-15 px-6 py-3 leading-none w-16">
            <%= t(".quantity") %>
          </th>
          <th class="text-left body-small-bold text-gray-800 bg-gray-15 px-6 py-3 leading-none w-16 whitespace-nowrap">
            <%= t(".total") %>
          </th>
        </tr>
      </thead>
      <tbody>
        <% manifest.each do |item| %>
          <tr class="border-gray-100 border-t">
            <td class="py-2 px-4">
              <%=
                render component("ui/forms/checkbox").new(
                  form: form_id,
                  value: item.variant.id,
                  "data-#{stimulus_id}-target": "checkbox",
                )
              %>
            </td>

            <td class="px-6 py-4">
              <div class="flex gap-2 grow">
                <% variant = item.variant %>
                <%= render component("ui/thumbnail").new(
                  src: (variant.images.first || variant.product.gallery.images.first)&.url(:small),
                  alt: variant.name
                ) %>
                <div class="flex-col">
                  <div class="leading-5 text-black body-small-bold"><%= variant.name %></div>
                  <div class="leading-5 text-gray-500 body-small">
                    SKU: <%= variant.sku %>
                    <%= variant.options_text.presence&.prepend("- ") %>
                  </div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4">
              <span class="text-gray-500 body-small whitespace-nowrap">
                <%= render component("ui/forms/input").new(
                  value: item.states["on_hand"],
                  form: form_id,
                  name: "variants[#{item.variant.id}][quantity]",
                  type: :number,
                  step: 1,
                  min: "1",
                  max: item.states["on_hand"],
                  "data-#{stimulus_id}-target": "quantity",
                  "data-action": "focus->#{stimulus_id}#selectRow",
                ) %>
              </span>
            </td>
            <td class="px-6 py-4">
              <span class="text-gray-500 body-small"><%= item.line_item.display_amount %></span>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <% modal.with_actions do %>
      <%= form_tag solidus_admin.split_create_order_shipment_path(@order, @shipment), method: :put, id: form_id, "data-action": "submit->#{stimulus_id}#submit" %>
      <%= render component("ui/button").new(tag: :a, scheme: :secondary, href: close_path, type: :submit, text: t('.cancel')) %>
      <%= render_split_action_button %>
    <% end %>
  <% end %>
</div>
