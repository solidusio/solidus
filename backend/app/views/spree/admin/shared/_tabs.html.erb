<% Spree::Backend::Config.menu_items.sort_by { |item| item.position || Float::INFINITY }.each do |menu_item| %>
  <% if instance_exec(&menu_item.condition) %>
    <%=
      tab(
        icon: menu_item.icon,
        label: menu_item.label,
        url: menu_item.url,
        selected: menu_item.match_path?(request) || menu_item.children.any? { _1.match_path?(request) },
      ) do
    %>
      <% if menu_item.render_partial? %>
        <%- render partial: menu_item.partial %>
      <% elsif menu_item.children.present? %>
        <ul class="admin-subnav" data-hook="<%= menu_item.data_hook %>">
          <%- menu_item.children.each do |child| %>
            <%= tab(
              icon: child.icon,
              label: child.label,
              url: child.url,
              selected: child.match_path?(request),
            ) if instance_exec(&child.condition) %>
          <% end %>
        </ul>
      <% end %>
    <%- end %>
  <% end %>
<% end %>
